Requirement already satisfied: torchvision in /home/algh/.local/lib/python3.11/site-packages (0.16.2)
Requirement already satisfied: accelerate in /home/algh/.local/lib/python3.11/site-packages (0.25.0)
Requirement already satisfied: datasets in /home/algh/.local/lib/python3.11/site-packages (2.18.0)
Requirement already satisfied: transformers in /home/algh/.local/lib/python3.11/site-packages (4.36.2)
Requirement already satisfied: numpy in /opt/itu/easybuild/software/SciPy-bundle/2023.07-gfbf-2023a/lib/python3.11/site-packages (from torchvision) (1.25.1)
Requirement already satisfied: requests in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from torchvision) (2.31.0)
Requirement already satisfied: torch==2.1.2 in /opt/itu/easybuild/software/PyTorch/2.1.2-foss-2023a-CUDA-12.1.1/lib/python3.11/site-packages (from torchvision) (2.1.2)
Requirement already satisfied: pillow!=8.3.*,>=5.3.0 in /opt/itu/easybuild/software/Pillow/10.0.0-GCCcore-12.3.0/lib/python3.11/site-packages (from torchvision) (10.0.0)
Requirement already satisfied: filelock in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from torch==2.1.2->torchvision) (3.12.2)
Requirement already satisfied: typing-extensions in /home/algh/.local/lib/python3.11/site-packages (from torch==2.1.2->torchvision) (4.15.0)
Requirement already satisfied: sympy in /opt/itu/easybuild/software/sympy/1.12-gfbf-2023a/lib/python3.11/site-packages (from torch==2.1.2->torchvision) (1.12)
Requirement already satisfied: networkx in /opt/itu/easybuild/software/networkx/3.1-gfbf-2023a/lib/python3.11/site-packages (from torch==2.1.2->torchvision) (3.1)
Requirement already satisfied: jinja2 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from torch==2.1.2->torchvision) (3.1.2)
Requirement already satisfied: fsspec in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from torch==2.1.2->torchvision) (2023.6.0)
Requirement already satisfied: packaging>=20.0 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from accelerate) (23.1)
Requirement already satisfied: psutil in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from accelerate) (5.9.5)
Requirement already satisfied: pyyaml in /opt/itu/easybuild/software/PyYAML/6.0-GCCcore-12.3.0/lib/python3.11/site-packages (from accelerate) (6.0)
Requirement already satisfied: huggingface-hub in /home/algh/.local/lib/python3.11/site-packages (from accelerate) (0.35.3)
Requirement already satisfied: safetensors>=0.3.1 in /home/algh/.local/lib/python3.11/site-packages (from accelerate) (0.6.2)
Requirement already satisfied: pyarrow>=12.0.0 in /home/algh/.local/lib/python3.11/site-packages (from datasets) (21.0.0)
Requirement already satisfied: pyarrow-hotfix in /home/algh/.local/lib/python3.11/site-packages (from datasets) (0.7)
Requirement already satisfied: dill<0.3.9,>=0.3.0 in /home/algh/.local/lib/python3.11/site-packages (from datasets) (0.3.8)
Requirement already satisfied: pandas in /opt/itu/easybuild/software/SciPy-bundle/2023.07-gfbf-2023a/lib/python3.11/site-packages (from datasets) (2.0.3)
Requirement already satisfied: tqdm>=4.62.1 in /home/algh/.local/lib/python3.11/site-packages (from datasets) (4.67.1)
Requirement already satisfied: xxhash in /home/algh/.local/lib/python3.11/site-packages (from datasets) (3.6.0)
Requirement already satisfied: multiprocess in /home/algh/.local/lib/python3.11/site-packages (from datasets) (0.70.16)
Requirement already satisfied: aiohttp in /home/algh/.local/lib/python3.11/site-packages (from datasets) (3.12.15)
Requirement already satisfied: regex!=2019.12.17 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from transformers) (2023.6.3)
Requirement already satisfied: tokenizers<0.19,>=0.14 in /home/algh/.local/lib/python3.11/site-packages (from transformers) (0.15.2)
Requirement already satisfied: hf-xet<2.0.0,>=1.1.3 in /home/algh/.local/lib/python3.11/site-packages (from huggingface-hub->accelerate) (1.1.10)
Requirement already satisfied: aiohappyeyeballs>=2.5.0 in /home/algh/.local/lib/python3.11/site-packages (from aiohttp->datasets) (2.6.1)
Requirement already satisfied: aiosignal>=1.4.0 in /home/algh/.local/lib/python3.11/site-packages (from aiohttp->datasets) (1.4.0)
Requirement already satisfied: attrs>=17.3.0 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from aiohttp->datasets) (23.1.0)
Requirement already satisfied: frozenlist>=1.1.1 in /home/algh/.local/lib/python3.11/site-packages (from aiohttp->datasets) (1.7.0)
Requirement already satisfied: multidict<7.0,>=4.5 in /home/algh/.local/lib/python3.11/site-packages (from aiohttp->datasets) (6.6.4)
Requirement already satisfied: propcache>=0.2.0 in /home/algh/.local/lib/python3.11/site-packages (from aiohttp->datasets) (0.3.2)
Requirement already satisfied: yarl<2.0,>=1.17.0 in /home/algh/.local/lib/python3.11/site-packages (from aiohttp->datasets) (1.20.1)
Requirement already satisfied: idna>=2.0 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from yarl<2.0,>=1.17.0->aiohttp->datasets) (3.4)
Requirement already satisfied: charset-normalizer<4,>=2 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from requests->torchvision) (3.1.0)
Requirement already satisfied: urllib3<3,>=1.21.1 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from requests->torchvision) (1.26.16)
Requirement already satisfied: certifi>=2017.4.17 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from requests->torchvision) (2023.5.7)
Requirement already satisfied: MarkupSafe>=2.0 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from jinja2->torch==2.1.2->torchvision) (2.1.3)
Requirement already satisfied: python-dateutil>=2.8.2 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from pandas->datasets) (2.8.2)
Requirement already satisfied: pytz>=2020.1 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from pandas->datasets) (2023.3)
Requirement already satisfied: tzdata>=2022.1 in /opt/itu/easybuild/software/SciPy-bundle/2023.07-gfbf-2023a/lib/python3.11/site-packages (from pandas->datasets) (2023.3)
Requirement already satisfied: six>=1.5 in /opt/itu/easybuild/software/Python-bundle-PyPI/2023.06-GCCcore-12.3.0/lib/python3.11/site-packages (from python-dateutil>=2.8.2->pandas->datasets) (1.16.0)
Requirement already satisfied: mpmath>=0.19 in /opt/itu/easybuild/software/SciPy-bundle/2023.07-gfbf-2023a/lib/python3.11/site-packages (from sympy->torch==2.1.2->torchvision) (1.3.0)
Loading CIFAR-10 dataset...
Train: 45000 | Val: 5000 | Test: 10000
Testing dataset...
Sample keys: ['pixel_values', 'labels']
Pixel values shape: torch.Size([3, 224, 224])
Label: tensor(4)

Loading pretrained ViT model...
Backbone frozen. Only classifier layer will be fine-tuned.
Trainable parameters: 7,690/85,806,346 (0.01%)

Training pretrained ViT (fine-tuning)...
{'loss': 270.14, 'learning_rate': 4.760163089099413e-06, 'epoch': 0.18}
{'loss': 271.3898, 'learning_rate': 4.460366950473679e-06, 'epoch': 0.36}
{'loss': 281.4742, 'learning_rate': 4.160570811847944e-06, 'epoch': 0.53}
{'loss': 271.0522, 'learning_rate': 3.860774673222209e-06, 'epoch': 0.71}
{'loss': 267.1394, 'learning_rate': 3.560978534596475e-06, 'epoch': 0.89}
{'eval_loss': 258.0277099609375, 'eval_accuracy': 0.264, 'eval_runtime': 46.4715, 'eval_samples_per_second': 107.593, 'eval_steps_per_second': 6.735, 'epoch': 1.0}
{'loss': 276.7625, 'learning_rate': 3.26118239597074e-06, 'epoch': 1.07}
{'loss': 271.9906, 'learning_rate': 2.961386257345006e-06, 'epoch': 1.24}
{'loss': 275.7552, 'learning_rate': 2.661590118719271e-06, 'epoch': 1.42}
{'loss': 273.9307, 'learning_rate': 2.3617939800935367e-06, 'epoch': 1.6}
{'loss': 264.7207, 'learning_rate': 2.0619978414678023e-06, 'epoch': 1.78}
{'loss': 267.2329, 'learning_rate': 1.7622017028420677e-06, 'epoch': 1.96}
{'eval_loss': 257.05059814453125, 'eval_accuracy': 0.4218, 'eval_runtime': 46.8851, 'eval_samples_per_second': 106.644, 'eval_steps_per_second': 6.676, 'epoch': 2.0}
{'loss': 271.6552, 'learning_rate': 1.4624055642163329e-06, 'epoch': 2.13}
{'loss': 263.911, 'learning_rate': 1.1626094255905985e-06, 'epoch': 2.31}
{'loss': 282.7172, 'learning_rate': 8.62813286964864e-07, 'epoch': 2.49}
{'loss': 264.4592, 'learning_rate': 5.630171483391294e-07, 'epoch': 2.67}
{'loss': 269.9685, 'learning_rate': 2.632210097133949e-07, 'epoch': 2.84}
{'eval_loss': 256.7895812988281, 'eval_accuracy': 0.4642, 'eval_runtime': 46.557, 'eval_samples_per_second': 107.395, 'eval_steps_per_second': 6.723, 'epoch': 3.0}
{'train_runtime': 1448.9209, 'train_samples_per_second': 93.173, 'train_steps_per_second': 5.824, 'train_loss': 271.8682660119682, 'epoch': 3.0}

Pretrained model test accuracy: 0.4451

Training ViT from scratch for comparison...
{'loss': 2.1783, 'learning_rate': 0.00018815025476952245, 'epoch': 0.18}
{'loss': 2.0953, 'learning_rate': 0.0001763005095390449, 'epoch': 0.36}
{'loss': 2.0591, 'learning_rate': 0.00016445076430856738, 'epoch': 0.53}
{'loss': 2.099, 'learning_rate': 0.00015260101907808984, 'epoch': 0.71}
{'loss': 2.0908, 'learning_rate': 0.00014075127384761228, 'epoch': 0.89}
{'eval_loss': 2.0498762130737305, 'eval_accuracy': 0.21, 'eval_runtime': 47.0482, 'eval_samples_per_second': 106.274, 'eval_steps_per_second': 6.653, 'epoch': 1.0}
{'loss': 2.0352, 'learning_rate': 0.00012890152861713474, 'epoch': 1.07}
{'loss': 2.0078, 'learning_rate': 0.0001170517833866572, 'epoch': 1.24}
{'loss': 1.9862, 'learning_rate': 0.00010520203815617963, 'epoch': 1.42}
{'loss': 1.9625, 'learning_rate': 9.33522929257021e-05, 'epoch': 1.6}
{'loss': 1.9059, 'learning_rate': 8.150254769522455e-05, 'epoch': 1.78}
{'loss': 1.9033, 'learning_rate': 6.965280246474701e-05, 'epoch': 1.96}
{'eval_loss': 1.8534364700317383, 'eval_accuracy': 0.3068, 'eval_runtime': 46.9028, 'eval_samples_per_second': 106.603, 'eval_steps_per_second': 6.673, 'epoch': 2.0}
{'loss': 1.845, 'learning_rate': 5.7803057234269463e-05, 'epoch': 2.13}
{'loss': 1.813, 'learning_rate': 4.595331200379192e-05, 'epoch': 2.31}
{'loss': 1.783, 'learning_rate': 3.410356677331438e-05, 'epoch': 2.49}
{'loss': 1.7441, 'learning_rate': 2.225382154283683e-05, 'epoch': 2.67}
{'loss': 1.7199, 'learning_rate': 1.0404076312359285e-05, 'epoch': 2.84}
{'eval_loss': 1.697998046875, 'eval_accuracy': 0.3606, 'eval_runtime': 47.0749, 'eval_samples_per_second': 106.214, 'eval_steps_per_second': 6.649, 'epoch': 3.0}
{'train_runtime': 2805.2736, 'train_samples_per_second': 48.124, 'train_steps_per_second': 3.008, 'train_loss': 1.938968105612243, 'epoch': 3.0}

Scratch model test accuracy: 0.3703

Generating comparison plot...
Generating attention visualization...
Attention visualization failed: Input type (torch.FloatTensor) and weight type (torch.cuda.FloatTensor) should be the same or input should be a MKLDNN tensor and weight is a dense tensor

========== SUMMARY ==========
Fine-tuned ViT accuracy: 0.4451
Scratch ViT accuracy:    0.3703
=============================
All results and plots saved in current directory.
